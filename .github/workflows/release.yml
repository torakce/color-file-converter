name: Build and Release

on:
  push:
    tags:
      - 'v*'  # DÃ©clenche sur les tags version (v1.0.0, v2.1.0, etc.)

permissions:
  contents: write  # NÃ©cessaire pour crÃ©er des releases

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x
        
    - name: Build Optimized Portable Version
      run: |
        powershell -ExecutionPolicy Bypass -File "scripts/Build-Portable-Light.ps1" -CleanBuild
        
    - name: Package Release
      run: |
        Compress-Archive -Path "Release/ColorFileConverter/*" -DestinationPath "ColorFileConverter-${{ github.ref_name }}.zip"
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        name: Color File Converter ${{ github.ref_name }}
        body: |
          ## ğŸ‰ Color File Converter ${{ github.ref_name }}
          
          ### ğŸ“¥ TÃ©lÃ©chargement :
          
          **ColorFileConverter-${{ github.ref_name }}.zip** (~194 MB)
          
          ### âœ¨ FonctionnalitÃ©s :
          - âœ… **Conversion PDF â†’ TIFF** (mono-page et multi-page)  
          - âœ… **AperÃ§u avec navigation par pages** (â—€ â–¶)
          - âœ… **Interface intuitive** avec zoom et pan
          - âœ… **Profils personnalisables** pour diffÃ©rents besoins
          - âœ… **Mode portable** - aucune installation requise
          - âœ… **Structure propre** - exe facilement accessible
          
          ### ğŸš€ Installation :
          1. **TÃ©lÃ©charger** le fichier ZIP
          2. **Extraire** dans un dossier
          3. **Double-cliquer** sur `Converter.Gui.exe` (visible Ã  la racine!)
          4. **C'est tout !** - Pas besoin de chercher dans des sous-dossiers
          
          ### ğŸ“‚ Structure :
          ```
          ColorFileConverter/
          â”œâ”€â”€ Converter.Gui.exe     â† Lancez directement ce fichier !
          â”œâ”€â”€ README.txt           
          â””â”€â”€ Runtime/             â† Toutes les dÃ©pendances
              â”œâ”€â”€ *.dll
              â””â”€â”€ Ghostscript/
          ```
          
        files: |
          ColorFileConverter-${{ github.ref_name }}.zip
        draft: false
        prerelease: false